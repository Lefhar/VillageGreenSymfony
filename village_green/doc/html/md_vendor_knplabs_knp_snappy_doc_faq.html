<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>village green: Frequently asked questions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">village green
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Frequently asked questions </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h5><em>Q</em>: It does not work and everything is broken.</h5>
<p ><em>A</em>: Please, try to execute the command manually in your shell. Snappy is a thin PHP wrapper and most likely your issue is with wkhtmltopdf itself or is already described in this FAQ. If not, feel free to open the issue in Snappy issue tracker.</p>
<p >Please, note that wkhtmltopdf takes only input URL(s) or file name(s) as source.</p>
<h5><em>Q</em>: How to get the command executed by Snappy?</h5>
<p ><em>A</em>: You need to install any PSR-3 compliant logging library and call <code>setLogger()</code> method on the generator. It will log every command executed, its env vars and timeout. It will also log stdout and stderr whenever a command finishes, even if it fails.</p>
<h5><em>Q</em>: My tables are broken when it is rendered on multiple pages with break.</h5>
<p ><em>A</em>: Add <code>thead</code> and <code>tbody</code> tags. Add the following css </p><div class="fragment"><div class="line">table { page-break-inside:auto; }</div>
<div class="line">tr    { page-break-inside:avoid; page-break-after:auto; }</div>
<div class="line">thead { display:table-header-group; }</div>
<div class="line">tfoot { display:table-footer-group; }</div>
</div><!-- fragment --><h5><em>Q</em>: I have a PNG with a transparent background. When generating a PDF, the background turns black.</h5>
<p ><em>A</em>: It is wkhtmltopdf bug as described in <a href="https://github.com/wkhtmltopdf/wkhtmltopdf/issues/2214">https://github.com/wkhtmltopdf/wkhtmltopdf/issues/2214</a>. You should update wkhtmltopdf to at least 0.12.3-dev</p>
<h5><em>Q</em>: Is there a way to secure the pdf so it can't be edited?</h5>
<p ><em>A</em>: There is no way to add a password via wkhtmltopdf, but there is a way via other linux tools like pdftk</p>
<h5><em>Q</em>: We are using wkhtmltopdf to export html to pdf. It breaks the HTML in two pages of pdf. Can we add a break?</h5>
<p ><em>A</em>: It is known problem of <code>wkhtmltopdf</code>. You can use css <code>page-break-after</code>, like: </p><div class="fragment"><div class="line">&lt;style type=&quot;text/css&quot;&gt;</div>
<div class="line">    .page {</div>
<div class="line">        overflow: hidden;</div>
<div class="line">        page-break-after: always;</div>
<div class="line">    }</div>
<div class="line">&lt;/style&gt;</div>
<div class="line"> </div>
<div class="line">&lt;div class=&quot;page&quot;&gt;</div>
<div class="line">   new page</div>
<div class="line">&lt;/div&gt;</div>
</div><!-- fragment --><h5><em>Q</em>: It says <code>wkhtmltopdf: cannot connect to X server</code> or <code>xvfb-run: error: Xvfb failed to start.</code></h5>
<p ><em>A</em>: Please, check your <code>wkhtmltopdf</code> version. It is recommended to use at least <code>0.12.2.1</code> and what is important - starting from <code>wkhtmltopdf &gt;= 0.12.2</code> it doesn't require X server or emulation anymore. You can download new version from <a href="http://wkhtmltopdf.org/downloads.html">http://wkhtmltopdf.org/downloads.html</a> or install via composer for Linux servers as stated in <a href="https://github.com/KnpLabs/snappy#wkhtmltopdf-binary-as-composer-dependencies">README</a>. If there is no possibility to update <code>wkhtmltopdf</code>, please check <a href="http://stackoverflow.com/questions/9604625/wkhtmltopdf-cannot-connect-to-x-server">http://stackoverflow.com/questions/9604625/wkhtmltopdf-cannot-connect-to-x-server</a></p>
<h5><em>Q</em>: PDF generation failed with wkhtmltopdf returning error code 1 due to ContentNotFoundError, how do I deal with that?</h5>
<p ><em>A</em>: This is a known problem with wkhtmltopdf. Several issues has been raised: <a href="https://github.com/wkhtmltopdf/wkhtmltopdf/issues/1855">issue 1855</a>, <a href="https://github.com/wkhtmltopdf/wkhtmltopdf/issues/2051">issue 2051</a>. To catch that error, <code>generate</code> method will throw a <code>RuntimeException</code> with error code equals to the error code returned with wkhtmltopdf, catch this exception and check for the error code and then deal with this exception in appropriate ways.</p>
<h5><em>Q</em>: My PDF is always generated for a small screen resolution\I always receive a mobile version.</h5>
<p ><em>A</em>: It is well-known issue of wkhtmltopdf, you can check <a href="https://github.com/wkhtmltopdf/wkhtmltopdf/issues/1508">https://github.com/wkhtmltopdf/wkhtmltopdf/issues/1508</a>. One of solutions is to use xvfb and to setup xvfb resolution to desired one though a simple bit of css such as <code>zoom: .75;</code> would be sufficient in most cases.</p>
<h5><em>Q</em>: My chars with accents in HTML document are not correctly rendered.</h5>
<p ><em>A</em>: Make sure that you have set <code>&lt;meta charset="UTF-8" /&gt;</code> in your HTML document, and you used the option <code>"encoding" =&gt; "utf-8"</code>.</p>
<h5><em>Q</em>: My document text is not correctly rendered, it is just black squares</h5>
<p ><em>A</em>: Make sure you have installed <code>xfonts-base</code>, <code>xfonts-75dpi</code> and <code>urw-fonts</code></p>
<h5><em>Q</em>: How to convert page with relative links from stdin / How to use relative media URLs</h5>
<p ><em>A</em>: When you convert an HTML file with relative links/media URLs into PDF, you need to either:</p><ul>
<li>Switch to absolute links/media URLs</li>
<li>Or use <code>&lt;base&gt;&lt;/base&gt;</code> tag to specify what's the base URL of those relative links.</li>
</ul>
<h5><em>Q</em>: How to generate a single PDF from multiple sources?</h5>
<p ><em>A</em>: Snappy and wkhtmltopdf both support generating a single PDF from multiple sources. To do so, you need to provide an array of input rather than a string.</p>
<div class="fragment"><div class="line">&lt;?php</div>
<div class="line"> </div>
<div class="line">$pdf = new \Knp\Snappy\Pdf(__DIR__ . <span class="stringliteral">&#39;/vendor/bin/wkhtmltopdf-amd64&#39;</span>);</div>
<div class="line">$pdf-&gt;generate([<span class="stringliteral">&#39;https://google.com&#39;</span>, <span class="stringliteral">&#39;https://google.jp&#39;</span>], <span class="stringliteral">&#39;/tmp/out/test.pdf&#39;</span>);</div>
<div class="line"><span class="comment">// or</span></div>
<div class="line">$pdf-&gt;generateFromHtml([<span class="stringliteral">&#39;&lt;html&gt;&lt;body&gt;Doc 1&lt;/body&gt;&lt;/html&gt;&#39;</span>, <span class="stringliteral">&#39;&lt;html&gt;&lt;body&gt;Doc 2&lt;/body&gt;&lt;/html&gt;&#39;</span>], <span class="stringliteral">&#39;/tmp/out/test.pdf&#39;</span>);</div>
</div><!-- fragment --><h5><em>Q</em>: My chars with accents passed to wkhtmltopdf options are not correctly rendered, i.e. &lsquo;footer-right =&gt; 'Página [page] de [toPage]&rsquo;&lsquo; is converted to 'PÃ¡gina 1 de 1&rsquo;.</h5>
<p ><em>A</em>: The answer is long here. We use <code>escapeshellarg</code> function to escape all the option value passed to <code>wkhtmltox</code>. <code>escapeshellarg</code> makes its escape based on server locale, so if you are experiencing this issue - you can set </p><div class="fragment"><div class="line">setlocale(LC_CTYPE, <span class="stringliteral">&#39;es_ES.UTF-8&#39;</span>)</div>
</div><!-- fragment --><p >or any locale which is suitable for you. You should take into account that if given locale is not configured on the server - you will still have an issue. Check your locales installed via running </p><div class="fragment"><div class="line">locale -a</div>
</div><!-- fragment --><p> If the needed locale is missing on the server - you should install/configure it.</p>
<h5><em>Q</em>: How to put an header/footer on every page of the PDF?</h5>
<p ><em>A</em>: You need to provide either a valid file path or some HTML content. Note that your HTML document(s) needs to start with a valid doctype and have html, head and body tags, or wkhtmltopdf will fail to render the PDF properly.</p>
<p ><em>Note that this feature does not work with wkhtmltopdf compiled against unpatched Qt. Most of the time, wkhtmltopdf packages from Linux distributions are not fine. You should rather rely on the official version available on <a href="https://wkhtmltopdf.org">wkhtmltopdf.org</a> or the version available from <code>h4cc/wkhtmltopdf</code> package.</em></p>
<div class="fragment"><div class="line">&lt;?php</div>
<div class="line">require __DIR__ . <span class="stringliteral">&#39;/vendor/autoload.php&#39;</span>;</div>
<div class="line"> </div>
<div class="line">$header = &lt;&lt;&lt;HTML</div>
<div class="line">&lt;!DOCTYPE html&gt;</div>
<div class="line">&lt;html&gt;</div>
<div class="line">  &lt;head&gt;&lt;style type=<span class="stringliteral">&quot;text/css&quot;</span>&gt;p { color: #FF0000; }&lt;/style&gt;&lt;/head&gt;</div>
<div class="line">  &lt;body&gt;&lt;p&gt;Lorem ipsum&lt;/p&gt;&lt;/body&gt;</div>
<div class="line">&lt;/html&gt;</div>
<div class="line">HTML;</div>
<div class="line"> </div>
<div class="line">$footer = &lt;&lt;&lt;HTML</div>
<div class="line">&lt;!DOCTYPE html&gt;</div>
<div class="line">&lt;html&gt;</div>
<div class="line">  &lt;head&gt;&lt;style type=<span class="stringliteral">&quot;text/css&quot;</span>&gt;p { color: #0000FF; }&lt;/style&gt;&lt;/head&gt;</div>
<div class="line">  &lt;body&gt;&lt;p&gt;Lorem ipsum&lt;/p&gt;&lt;/body&gt;</div>
<div class="line">&lt;/html&gt;</div>
<div class="line">HTML;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Without html extension you might face following error:</span></div>
<div class="line"><span class="comment">// Exit with code 1, due to unknown error.</span></div>
<div class="line">$footerPath = tempnam(<span class="stringliteral">&#39;/tmp&#39;</span>, <span class="stringliteral">&#39;footer&#39;</span>) . <span class="stringliteral">&#39;.html&#39;</span>;</div>
<div class="line">file_put_contents($footerPath, $footer);</div>
<div class="line"> </div>
<div class="line">$pdf = new \Knp\Snappy\Pdf(__DIR__ . <span class="stringliteral">&#39;/vendor/bin/wkhtmltopdf-amd64&#39;</span>);</div>
<div class="line">$pdf-&gt;generateFromHtml(<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;/tmp/out/test.pdf&#39;</span>, [<span class="stringliteral">&#39;header-html&#39;</span> =&gt; $header, <span class="stringliteral">&#39;footer-html&#39;</span> =&gt; $footerPath], <span class="keyword">true</span>);</div>
</div><!-- fragment --><h5><em>Q</em>: Is it possible to include an header and/or footer only on some specific pages?</h5>
<p ><em>A</em>: No, wkhtmtopdf does not allow this.</p>
<h5><em>Q</em>: When running wkhtmltopdf through Snappy, I got an exit code 5 or 6</h5>
<p ><em>A</em>: It's usually due to bad environment variables. For example, on MacOS, you need to check the value of <code>DYLD_LIBRARY_PATH</code> (see <a href="https://github.com/KnpLabs/snappy/issues/27#issuecomment-7199659">#27</a>). On Linux, you should check the value of <code>LD_LIBRARY_PATH</code>. Also note that, depending on the way you execute PHP, your environment variables might be reset for security reasons (for instance, look at <code>clear_env</code> on php-fpm).</p>
<h5><em>Q</em>: On Windows, when I generate a PDF nothing happens (there's no PDF file written)</h5>
<p ><em>A</em>: You should check with sysinternals procmon if you experience <code>ACCESS_DENIED</code> error. If that's the case, you need to give execution permission to IIS users on wkhtmltopdf binary. Also, your user(s) should have write permissions on the temporary folder.</p>
<p >For more details see <a href="https://github.com/KnpLabs/snappy/issues/123">#123</a>.</p>
<h5><em>Q</em>: Snappy takes an endless amount of time to generate a PDF and eventually fails due to timeout</h5>
<p ><em>A</em>: This is generally indicating some networking issues. It might be bad DNS record(s), some sporadic packet losses, unresponsive HTTP server ...</p>
<p >Note that if you use the PHP embedded server, you can't generate a PDF from an HTML page accessible from the same embedded server. Indeed, the embedded server never forks and does not use threads. That means it's not able to process two requests at the same time: it processes the first one, send the first response and only then starts to process the second one.</p>
<h5><em>Q</em>: How to proceed when experiencing <code>ContentNotFound</code>, <code>ConnectionRefusedError</code> or timeouts?</h5>
<p ><em>A</em>: When you experience errors like <code>ContentNotFound</code> or <code>ConnectionRefusedError</code>, try to turn off <code>quiet</code> option and look at Snappy logs (you have to set up a logger first).</p>
<p >If you experience timeouts, it might be hard to know what is failing. The best you can do to narrow the scope of the bug is to slightly change your HTML code until you found the culprit. Start by removing whole parts, like document body to know if it comes from something in the body or something in the head. If that's now working, re-add it but now remove one half of its content. And repeat again and again until you find which URLs is buggy.</p>
<p >There's one more (better) way though: fire up tcpdump or wireshark and listen for http requests. You should see which request(s) is failing, and you can even check the content of the request/response.</p>
<h5><em>Q</em>: My custom fonts aren't smooth</h5>
<p >According to #326, you shall prefer using SVG versions of your custom fonts to have a better font smoothing. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2
</small></address>
</body>
</html>
