<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>village green: AtomicCache Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">village green
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><b>Amp</b></li><li class="navelem"><a class="el" href="namespace_amp_1_1_cache.html">Cache</a></li><li class="navelem"><a class="el" href="class_amp_1_1_cache_1_1_atomic_cache.html">AtomicCache</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a>  </div>
  <div class="headertitle"><div class="title">AtomicCache Class Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a6bada3d8785a27301945e8615e6c1c4b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_amp_1_1_cache_1_1_atomic_cache.html#a6bada3d8785a27301945e8615e6c1c4b">__construct</a> (<a class="el" href="class_amp_1_1_cache_1_1_serialized_cache.html">SerializedCache</a> $cache, <a class="el" href="interface_amp_1_1_sync_1_1_keyed_mutex.html">KeyedMutex</a> $mutex)</td></tr>
<tr class="separator:a6bada3d8785a27301945e8615e6c1c4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5ba2409326fbc4d818527b235351dcb7"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_amp_1_1_cache_1_1_atomic_cache.html#a5ba2409326fbc4d818527b235351dcb7">compute</a> (string $key, callable $create, ?int $ttl=null)</td></tr>
<tr class="separator:a5ba2409326fbc4d818527b235351dcb7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5c88603df61e8ad7a94a4fba8844875"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_amp_1_1_cache_1_1_atomic_cache.html#ab5c88603df61e8ad7a94a4fba8844875">computeIfAbsent</a> (string $key, callable $create, ?int $ttl=null)</td></tr>
<tr class="separator:ab5c88603df61e8ad7a94a4fba8844875"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af7112ab5164d5cb63f74d5533ec159b7"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_amp_1_1_cache_1_1_atomic_cache.html#af7112ab5164d5cb63f74d5533ec159b7">computeIfPresent</a> (string $key, callable $create, ?int $ttl=null)</td></tr>
<tr class="separator:af7112ab5164d5cb63f74d5533ec159b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ae167f48770390fe0d27399bf87de7d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_amp_1_1_cache_1_1_atomic_cache.html#a3ae167f48770390fe0d27399bf87de7d">set</a> (string $key, $value, ?int $ttl=null)</td></tr>
<tr class="separator:a3ae167f48770390fe0d27399bf87de7d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0cf528a9877eb7b5aa22e841a0c81669"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_amp_1_1_cache_1_1_atomic_cache.html#a0cf528a9877eb7b5aa22e841a0c81669">get</a> (string $key, $default=null)</td></tr>
<tr class="separator:a0cf528a9877eb7b5aa22e841a0c81669"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac03d0331371567f0a97a6782746abd55"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_amp_1_1_cache_1_1_atomic_cache.html#ac03d0331371567f0a97a6782746abd55">delete</a> (string $key)</td></tr>
<tr class="separator:ac03d0331371567f0a97a6782746abd55"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >@template TValue </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a6bada3d8785a27301945e8615e6c1c4b" name="a6bada3d8785a27301945e8615e6c1c4b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6bada3d8785a27301945e8615e6c1c4b">&#9670;&nbsp;</a></span>__construct()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__construct </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_amp_1_1_cache_1_1_serialized_cache.html">SerializedCache</a>&#160;</td>
          <td class="paramname"><em>$cache</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="interface_amp_1_1_sync_1_1_keyed_mutex.html">KeyedMutex</a>&#160;</td>
          <td class="paramname"><em>$mutex</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype"></td><td class="paramname">SerializedCache&lt;TValue&gt;</td><td>$cache </td></tr>
    <tr><td class="paramtype">KeyedMutex</td><td class="paramname">$mutex</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a5ba2409326fbc4d818527b235351dcb7" name="a5ba2409326fbc4d818527b235351dcb7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5ba2409326fbc4d818527b235351dcb7">&#9670;&nbsp;</a></span>compute()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">compute </td>
          <td>(</td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>$key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">callable&#160;</td>
          <td class="paramname"><em>$create</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">?int&#160;</td>
          <td class="paramname"><em>$ttl</em> = <code>null</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Obtains the lock for the given key, then invokes the $create callback with the current cached value (which may be null if the key did not exist in the cache). The value returned from the callback is stored in the cache and the promise returned from this method is resolved with the value.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$key</td><td></td></tr>
    <tr><td class="paramtype"></td><td class="paramname">callable(string,mixed|null)</td><td>mixed $create Receives $key and $value as parameters. </td></tr>
    <tr><td class="paramtype">int&#160;|&#160;null</td><td class="paramname">$ttl</td><td>Timeout in seconds. The default <code>null</code> $ttl value indicates no timeout.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Promise&lt;mixed&gt;</dd></dl>
<p>@psalm-param callable(string, TValue|null):(TValue|Promise&lt;TValue&gt;|\Generator&lt;mixed, mixed, mixed, TValue&gt;) $create @psalm-return Promise&lt;TValue&gt;</p>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname"><a class="el" href="class_amp_1_1_cache_1_1_cache_exception.html">CacheException</a></td><td>If the $create callback throws an exception while generating the value. </td></tr>
    <tr><td class="paramname">SerializationException</td><td>If serializing the value returned from the callback fails. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ab5c88603df61e8ad7a94a4fba8844875" name="ab5c88603df61e8ad7a94a4fba8844875"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab5c88603df61e8ad7a94a4fba8844875">&#9670;&nbsp;</a></span>computeIfAbsent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">computeIfAbsent </td>
          <td>(</td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>$key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">callable&#160;</td>
          <td class="paramname"><em>$create</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">?int&#160;</td>
          <td class="paramname"><em>$ttl</em> = <code>null</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Attempts to get the value for the given key. If the key is not found, the key is locked, the $create callback is invoked with the key as the first parameter. The value returned from the callback is stored in the cache and the promise returned from this method is resolved with the value.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$key</td><td><a class="el" href="interface_amp_1_1_cache_1_1_cache.html">Cache</a> key. </td></tr>
    <tr><td class="paramtype"></td><td class="paramname">callable(string)</td><td>mixed $create Receives $key as parameter. </td></tr>
    <tr><td class="paramtype">int&#160;|&#160;null</td><td class="paramname">$ttl</td><td>Timeout in seconds. The default <code>null</code> $ttl value indicates no timeout.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Promise&lt;mixed&gt;</dd></dl>
<p>@psalm-param callable(string, TValue|null):(TValue|Promise&lt;TValue&gt;|\Generator&lt;mixed, mixed, mixed, TValue&gt;) $create @psalm-return Promise&lt;TValue&gt;</p>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname"><a class="el" href="class_amp_1_1_cache_1_1_cache_exception.html">CacheException</a></td><td>If the $create callback throws an exception while generating the value. </td></tr>
    <tr><td class="paramname">SerializationException</td><td>If serializing the value returned from the callback fails. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="af7112ab5164d5cb63f74d5533ec159b7" name="af7112ab5164d5cb63f74d5533ec159b7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af7112ab5164d5cb63f74d5533ec159b7">&#9670;&nbsp;</a></span>computeIfPresent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">computeIfPresent </td>
          <td>(</td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>$key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">callable&#160;</td>
          <td class="paramname"><em>$create</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">?int&#160;</td>
          <td class="paramname"><em>$ttl</em> = <code>null</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Attempts to get the value for the given key. If the key exists, the key is locked, the $create callback is invoked with the key as the first parameter and the current key value as the second parameter. The value returned from the callback is stored in the cache and the promise returned from this method is resolved with the value.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$key</td><td><a class="el" href="interface_amp_1_1_cache_1_1_cache.html">Cache</a> key. </td></tr>
    <tr><td class="paramtype"></td><td class="paramname">callable(string,mixed)</td><td>mixed $create Receives $key and $value as parameters. </td></tr>
    <tr><td class="paramtype">int&#160;|&#160;null</td><td class="paramname">$ttl</td><td>Timeout in seconds. The default <code>null</code> $ttl value indicates no timeout.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Promise&lt;mixed&gt;</dd></dl>
<p>@psalm-param callable(string, TValue|null): (TValue|Promise&lt;TValue&gt;|\Generator&lt;mixed, mixed, mixed, TValue&gt;) $create @psalm-return Promise&lt;TValue&gt;</p>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname"><a class="el" href="class_amp_1_1_cache_1_1_cache_exception.html">CacheException</a></td><td>If the $create callback throws an exception while generating the value. </td></tr>
    <tr><td class="paramname">SerializationException</td><td>If serializing the value returned from the callback fails. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ac03d0331371567f0a97a6782746abd55" name="ac03d0331371567f0a97a6782746abd55"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac03d0331371567f0a97a6782746abd55">&#9670;&nbsp;</a></span>delete()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">delete </td>
          <td>(</td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>$key</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >The lock is obtained for the key before deleting the key.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$key</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="interface_amp_1_1_promise.html">Promise</a>&lt;bool|null&gt;</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="class_amp_1_1_cache_1_1_serialized_cache.html#ac03d0331371567f0a97a6782746abd55">SerializedCache::delete()</a> </dd></dl>

</div>
</div>
<a id="a0cf528a9877eb7b5aa22e841a0c81669" name="a0cf528a9877eb7b5aa22e841a0c81669"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0cf528a9877eb7b5aa22e841a0c81669">&#9670;&nbsp;</a></span>get()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">get </td>
          <td>(</td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>$key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$default</em> = <code>null</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Returns the cached value for the key or the given default value if the key does not exist.</p>
<p >@template TDefault</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$key</td><td><a class="el" href="interface_amp_1_1_cache_1_1_cache.html">Cache</a> key. </td></tr>
    <tr><td class="paramtype">mixed</td><td class="paramname">$default</td><td>Default value returned if the key does not exist. Null by default.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="interface_amp_1_1_promise.html">Promise</a>&lt;mixed|null&gt; Resolved with null iff $default is null.</dd></dl>
<p>@psalm-param TDefault $default @psalm-return <a class="el" href="interface_amp_1_1_promise.html">Promise</a>&lt;TValue|TDefault&gt;</p>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname"><a class="el" href="class_amp_1_1_cache_1_1_cache_exception.html">CacheException</a></td><td></td></tr>
    <tr><td class="paramname">SerializationException</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="class_amp_1_1_cache_1_1_serialized_cache.html#ac009cde80e71e456bac8af41d5d021c6">SerializedCache::get()</a> </dd></dl>

</div>
</div>
<a id="a3ae167f48770390fe0d27399bf87de7d" name="a3ae167f48770390fe0d27399bf87de7d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3ae167f48770390fe0d27399bf87de7d">&#9670;&nbsp;</a></span>set()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">set </td>
          <td>(</td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>$key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">?int&#160;</td>
          <td class="paramname"><em>$ttl</em> = <code>null</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >The lock is obtained for the key before setting the value.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$key</td><td><a class="el" href="interface_amp_1_1_cache_1_1_cache.html">Cache</a> key. </td></tr>
    <tr><td class="paramtype">mixed</td><td class="paramname">$value</td><td>Value to cache. </td></tr>
    <tr><td class="paramtype">int&#160;|&#160;null</td><td class="paramname">$ttl</td><td>Timeout in seconds. The default <code>null</code> $ttl value indicates no timeout.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Promise&lt;void&gt; Resolves either successfully or fails with a <a class="el" href="class_amp_1_1_cache_1_1_cache_exception.html">CacheException</a> on failure.</dd></dl>
<p>@psalm-param TValue $value @psalm-return Promise&lt;void&gt;</p>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname"><a class="el" href="class_amp_1_1_cache_1_1_cache_exception.html">CacheException</a></td><td></td></tr>
    <tr><td class="paramname">SerializationException</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="class_amp_1_1_cache_1_1_serialized_cache.html#aaca1a6d3cb4e65def1552d4705c9854d">SerializedCache::set()</a> </dd></dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>vendor/amphp/cache/lib/AtomicCache.php</li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2
</small></address>
</body>
</html>
